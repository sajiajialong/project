---
title: "Electronic Cigarette and Youth"
author: "Shengjie Sun & Chen Chen"
date: "2019-04-30"
categories: ["R"]
tags: ["R Markdown", "plot", "regression"]
---

```{r, warning=FALSE, message=FALSE, include=FALSE}
library(ggplot2)
library(dplyr)
library(GGally)
library(vcd)
library(vcdExtra)
library(RColorBrewer)

setwd("/Users/husky/Desktop/5293/project/")
#setwd("C:/Users/sheng/OneDrive/CU Second Semester/Statistical Graphics/Final Project")

questions_num <- readr::read_csv("./output/Number of Questions.csv") %>% 
  mutate(Type = factor(Type, levels = c("Indirectly Related", "Directly Related")))

NYTS_2018_Full <- readr::read_csv("./data/2018-NYTS/nyts2018.csv")
NYTS_2018_Selected <- readRDS("./output/NYTS_2018_Selected.rds")

adv <- readRDS("./output/adv.rds")
ratio <- readRDS("./output/ratio.rds")
regular <- readRDS("./output/regular.rds")
age_first1 <- readRDS("./output/age_first1.rds")
regular_per <- readRDS("./output/regular_per.rds")
addiction.rate <- readRDS("./output/addiction.rate.rds")
addiction.rate.male <- readRDS("./output/addiction.rate.male.rds")
addiction.rate.female <- readRDS("./output/addiction.rate.female.rds")
```


# I. Introduction

## E-cigarette Basics
E-cigarettes are devices that heat a liquid into an aerosol that the user inhales. The liquid usually has nicotine and flavoring in it, and other additives. E-cigarettes are considered tobacco products because most of them contain nicotine, which comes from tobacco. Also known as e-cigarettes, e-cigs, electronic nicotine delivery systems, vaporizer cigarettes, and vape pens, they are marketed as a way to stop or cut down on smoking. It aims to provide a similar sensation to inhaling tobacco smoke, without the smoke.

## E-cigarette and Youth
E-cigarettes are very popular with young people. Their use has grown dramatically in the last eight years. Today, more high school students use e-cigarettes than regular cigarettes. The use of e-cigarettes is higher among high school students than adults according to National Youth Tobacco Survey.

## Goal of This Blog
There are lots of voice that e-cigarettes are harmful to youth and they also report that e-cigarettes are more and more popular among youth. In this blog, we will not argue that whether or not the e-cigarette is a good thing as it may help reduce the usage of traditional cigarettes, reported by some articles, while the traditional cigarettes are far more harmful than electronic ones.

In this blog, we will focus on the true distribution of the usage of e-cigarettes among youth. And pay greate attention on the reason of choosing e-cigarettes. By doing this, we found that prohibiting e-cigarettes by telling them e-cigarettes are harmful is not effective!


# II. Description of the data source
We mainly collect row data from `Centers for Disease Control and Prevention` and the link is: https://www.cdc.gov/tobacco/data_statistics/surveys/nyts/data/index.html. 

Data are available in SAS, Microsoft Access, and Microsoft Excel formats, as well as PDFs of the questionnaire, codebook, and methodology report.

The data reveals the smoking and tobacco usage among youth and collected by doing survey called `National Youth Tobacco Survey (NYTS)`. Data from 1999 and 2018 are available but we only choose those from 2011 to 2018 as the topics releated to electronic cigarette appear in these surveys as early as 2011. The data for a particular year, say 2018 looks like following:

```{r data source, echo=FALSE, warning=FALSE, message=FALSE}
DT::datatable(NYTS_2018_Full[1:20,15:20])
```

Of course this is just a small part of the whole data. The 2019 NYTS data has 20189 observations and 373 variables. But actually the survey has only 88 questions and the reason for 373 rather than variables is that some questions contains several response and thus needing more columns to store and there are also many columns contains some statistical index calculated by `Centers for Disease Control and Prevention`. But all of those statistics are related to normal cigarettes and thus worth little to us.

The biggest problem for us is that the questionnaire are different from year to year and we need to go through every questions in each year and select the questions that:

1. related to electronic cigarettes,
2. appear at least four years,
3. high quality and can reveal some "truth".

We divided all the questions related to e-cigarettes into indirectly related and directly related based on whether the words such as "e-cigaretted", "vape", etc appears in questions or just appears as an options/selections.

It is quite clear that the number of leaps from 2013 to 2014 and goes to peak in 2016. It's may worth to mention that all survey questionnaire of 2017 and 2018 are the same.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
questions_num %>% mutate(Year = factor(Year)) %>%
  ggplot() + 
  geom_col(aes(x=Year, y=Number, fill=Type)) + 
  scale_fill_manual(values = c("gray75", "gray45"))
```

Before 2011, there is no question related to e-cigarettes/vapes, and during 2011, 2012 and 2013, e-cigarettes and vapes are just mentioned within questions. From 2014 to 2016, great attention was paid while the questions varies. Starting from 2017, the questions related to e-cigarettes keep same. 

All the questions selected are post in another blog called `All National Youth Tobacco Survey Questions Related to Electronic Cigarette` feel free to check it.

# III. Description of data import / cleaning / transformation
The criteria/requirments say we can not include codes in this blog, but indeed for this part it is more efficient to explain combined with codes. Anyway, the data were download in csv file and imported with `readr::read_csv()` soomthly. Some `NA` is filtered and some questions with multiple responses stored in several in columns are combined together. Some responses are low quality and useless, for example some students may choose "I have never used e-cigarettes" and "I used e-cigarettes in last 30 days" at the same time. If you want to check the codes, we also posted them in the third blog, feel free to check that!.

# IV. Analysis of missing values
Describe any patterns you discover in missing values.

# V. Results

## Trends and Patterns of the Usage of E-cigarettes

## lalalalala
One thing we are interested in is how likely people become "addictive" after they try e-cigarettes once or twice and become regular smokers. We define "addictive" and "regular smokers" as thoses who spend more than two days to smoke e-cigarettes within 30 days. This question is addressed in two steps: 
1) what is the percentage of regular smokers in the whole population?
2) what is the percentage of regular smokers among those who tried to smoke once or twice? That is, how likely that people become "addictive" after they have a try to e-cigarettes?
  And in order to give our readers a direct impression about the extent of addction, we compare with the data of ordinary cigarettes. The results are shown in the following several figures.
```{r, echo=FALSE, warning=FALSE, message=FALSE}
ggplot()+
  geom_line(aes(x=2014:2018,y=regular_per[1,],color="e-cigarette"),size=1.5)+
  geom_line(aes(x=2014:2018,y=regular_per[2,],color="cigarette"),size=1.5)+
  xlab("year")+
  ylab("percentage of regular smoker")+ggtitle("percentage of regular smoker of e-cigarette/cigarette in each year")
```

The lines in the figure answers the first question, showing above shows that there about 4.5% to 9% regular e-cigarettes users in the youth, compared to 3% to 4% regular cigarettes smakers in the youth. This result is probably contradictary to our commen sense: there are more cigarettes smokers around us than e-cigarettes smakers. Our commen sense may be true for adults, however, it is a different story in youth group. E-cigarettes are more popular in youth group.

Another thing that worths to notices is that the percentage of regular e-cigarettes smokers is generally increases while the percentage of cigarettes is generally decreasing, suggesting e-cigarettes are becoming a trend among youth.

In addition to the investigations in the whole youth population, gender is also considered as an important factor: we would like to find out whether there is a huge difference between different genders with respect to smoking. Here is the result:

```{r, echo=FALSE, warning=FALSE, message=FALSE}
ggplot()+ 
  geom_line(aes(x=2014:2018,y=ratio[1,],color="e-cigarette"))+
  geom_line(aes(x=2014:2018,y=ratio[2,],color="cigarette"))+
  xlab("year")+ylab("ratio:female/male ")+
  ggtitle("ratio of female and male regular smokers")
```

It seems that males are more "fashionable" in regards to smoking. There is higher female precentage in traditional smoking, than in the new-born e-cigarettes smoking.

To answer the second question, we plot the percentage of regular smokers among those who tried to smoke once or twice. Ther higher the percentage is, the more likely people sink into it.


### Age
As previously shown, e-cigarettes seem to become more and more popular among young people. Not only is it reflected in the percentage of regular smokers, but also reflected in the age when people try e-cigarettes for the first time. 
```{r, echo=FALSE, warning=FALSE, message=FALSE}
age_first1 %>% 
  mutate(year = factor(year)) %>%
  ggplot()+
  geom_boxplot(aes(y=age,x=year,fill=year))+
  xlab("year")+
  ylab("age of first-time smoking")+
  ggtitle("boxplot of age of trying e-cigarette for the first time")
```
The figure above shows that the age when the youth try their first taste of e-cigarettes becomes younger. In the investigation in 2014, it happened at the age of 15. Now in 2018, it happens at the age of 14.

### Days
One one hand, we see the popularity of e-cigarettes among youth. On the other hand, the days people spend to use e-cigarettes is increasing. We suspect it is partially due to the popularity of e-cigarettes. One possibility is that when people realize e-cigarette is a fishionable thing, they may have less motive to restrain themselves from it. Another reason we can think of is that people with more years of smoking experience tend to smoke more often. E-cigarettes is a new thing, so the percentage of many-years smoker is still increasing.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
ggplot(data = regular[regular$key=="e"&regular$days>0,])+
  geom_boxplot(aes(y=days,x=as.factor(year),fill=as.factor(year)))+
  xlab("year")+ylab("days of smoking within one month")+
  ggtitle("boxplot of days of smoking within one month")
```
The figure above shows that in 2014, the average days people spend in smoke was 9 days. Afterwards it gradually increases to 14 days in 2018.

### Advertisement
The questionair includs questions about advertisement in four kinds of media: internet, newspaper, supermarkets, TV. It asks how often do youth see advertisement of e-cigarette in those media. Five options are given: never, rarely, sometimes, most of the time, always.

```{r, echo=FALSE, warning=FALSE, message=FALSE}
index<-complete.cases(adv)
adv<- adv[adv$fre>1 & index,]
adv$fre<- as.factor(adv$fre)
adv$source<-as.factor(adv$source)
levels(adv$fre)<- c("Never","Rarely","Sometimes","Most of the time","Always")
platte <- rev(brewer.pal(5, 'RdBu'))
vcd::mosaic(fre ~ source, adv,
            direction = c("v", "h"),
            gp = gpar(fill = platte),
            rot_labels=c(0,90,0,0))
```

From the figure above, we are able to conclude that less advertisements are put in newspaper. Relatively more ads are put in internet, supermarket and TV. It is possibly because less and less people read newspapers. It looks like it is more often to see advertisement of e-cigarettes in supermarket. Though youth may show up on the internet more often, supermarket is the main battleground for e-cigarette to win custumers. One explaination is that people with purchasing power are more likely to go to supermarket, and manufacturer wants to win over those potential clinets.

## Analysis

### Attitudes of E-cigarettes
We combined the following five questions together:

Q27. Have you ever been curious about using an e-cigarette?

The reponse of the questions are shown by the color in lengend `Type`, The red lines indicates the response of those who are curious about e-cigarettes and the blue/green lines shows those of not curious.

Q35. Do you think that you will try an e-cigarette soon? 

Q36. Do you think you will use an e-cigarette in the next year?

Q37. If one of your best friends were to offer you an e-cigarette, would you use it?

Q3. What grade are you in?

Due to the limitation of `GGally::ggparcoord()`, only 2000 response can plot at one time. Therefore we sampled 2000 response randomly and the following patterns/findings are nearly repeats every times. 

```{r, echo=FALSE, warning=FALSE, message=FALSE}
NYTS_2018_Selected %>% 
  filter(Q28 == 2) %>% 
  select('Q27','Q35','Q36','Q37','Q3') %>% 
  mutate(Type = ifelse(Q27<=2, "Curious","Not Curious")) %>%
  mutate(Q3 = readr::parse_integer(Q3)-1.5) %>%
  sample_n(2000) %>%
  ggparcoord(columns = 2:5, scale = "globalminmax", splineFactor = 10, alphaLines = 0.5, groupColumn = 6) +
  scale_y_discrete(limits=c("Definitely yes","Probably yes","Probably not","Definitely not")) +
  labs(x="Questions",y="Responses")
```

The most obvious pattern are whether youth are curious about the e-cigarettes almost determines whether they will try e-cigarettes. 

If we exam the pictures more carefully, we can see the effects of friends. The lines accross `Probably yes` and `Definitely yes` from `Q37` are denser than those from `Q35` and `Q36`. This indicates a little bit of the reasons of why youth use e-cigarettes. If you can not see clearly due to the bad representation of the samples, never mind, we will study this more throughtly in the following parts. 

### What are the reasons youths have used ecigarettes? (Select one or more)

A. I have never tried an e-cigarette

B. Friend or family member used them

C. To try to quit using other tobacco products, such as cigarettes

D. They cost less than other tobacco products, such as cigarettes

E. They are easier to get than other tobacco products, such as cigarettes

F. Famous people on TV or in movies use them

G. They are less harmful than other forms of tobacco, such as cigarettes

H. They are available in flavors, such as mint, candy, fruit, or chocolate

I. They can be used in areas where other tobacco products, such as cigarettes, are not allowed

J. I used them for some other reason

As indicateds in the subtitles, this is a questions with several responses. Generally, this kind of data are very difficult to visualize. We will exam these data step by step.

First, we clean the data a little bit and create a new columns called `Q33` showing the response in a human reading way. And the filter `Q33A` as we only care about those have tried e-cigarettes. 
```{r, echo=FALSE, warning=FALSE, message=FALSE}
Reasons <- NYTS_2018_Selected %>% filter(is.na(Q33A)) %>% select(matches("Q(1|2|3)$"), contains('Q33'))
Reasons[19:25,5:14]
```
You know what? There are totally 159 different combination appears! But mathematically speaking, there could be 512 different choice at most. So, definitely, there are some patterns behind. 

In the following plot, we only count the frequency of each choice without considering the combination. It if quite clear that choice B: Friend or family member used them is the major reasons for youth to try e-cigarettes. And the second is e-cigarettes are available in flavors, such as mint, candy, fruit, or chocolate. And then they are less harmful than other forms of tobacco, such as cigarettes if we do not consider other reasons, i.e. choice J. Health is not the major reason for youth to choice e-cigarettes!! And if only counts less than half of influence of friends and familys!!

```{r, echo=FALSE, warning=FALSE, message=FALSE}
NYTS_2018_Full %>% select(contains('Q33')) %>% 
  select(-Q33A) %>% as.matrix() %>% colSums(.,na.rm = T) %>% 
  tibble(Choice = c("B","C","D","E","F","G","H","I","J"), Count = .) %>%
  ggplot() + 
  geom_col(aes(x=Choice, y=Count))
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
Reasons %>% count(Q33) %>% filter(n>=10) %>% arrange(desc(n)) %>%
  filter(n!=75) %>% mutate(Related_to_B = ifelse(stringr::str_detect(Q33, "B"), 'Yes', 'No')) %>%
  mutate(Q33 = forcats::fct_reorder(Q33, n, .desc=FALSE)) %>%
  mutate(Count = n) %>%
  ggplot() +
  geom_col(aes(x = Q33, y=Count, fill=Related_to_B)) +
  coord_flip()
```


```{r, echo=FALSE, warning=FALSE, message=FALSE}
ggplot()+
  geom_line(aes(x=2014:2018,y=addiction.rate.male,color="male"))+
  geom_line(aes(x=2014:2018,y=addiction.rate,color="overall"),size=1)+
  geom_line(aes(x=2014:2018,y=addiction.rate.female,color="female"))+
  xlab("year")+
  ylab("addiction rate")+
  ggtitle("percentage of those who tried e-cigarette to be addicted to it")
```

The figure above shows that 25% of those who are willing to try e-cigarettes turn out to be regular smokers. Tha explaination for this can be multiple: it is possible that in the beginning 1/4 of the triers are determined to be regular smokers. Or it is possible that e-cigarettes can attract 1/4 of the triers. Gender also plays a role in the process. Female are less likely to turn into a regular e-cigarette smoker than males.


<iframe src="https://paranoidism.shinyapps.io/e-cigarette/" width=1000 height=800"></iframe>



##############
Our dear reader might also have your own opinion about e-cigarettes, like whether it is harmful, or whether its flavors are fascinating. People with different reasons to try e-cigarettes might end up with different level of addiction to e-cigarettes. Some might just give it up. Others might become a regular user. Others might be obsessed with it. Different genders might also have different results in regard to the extent of addiction. With the data that we have, a rough estimate to the level of addiction can be given on the basis that you plan to have a try to e-cigarettes of have already had a try to e-cigarettes. Here is the guidance:

1 Ask yourself whether you are going to have a try to e-cigarettes or have already had a try before. If not, just forget about it. If yes, go to the next step.
2 Choose your opinion about e-cigarettes. You can check multiple options.
3 Look up the barplot. 
There are 7 groups of bars, each of which includes a bar for female (red) and a bar for male (green). The x-axis are the number of days to smoke e-cigarettes within 30 days. That represents the level of addiction to e-cigarettes: the group in the most left side is the group who did not smoke any e-cigarettes during the last 30 days. We can take that as the lowest level of addiction. The group on the most right side is the group who smoke e-cigarettes every day during the past 30 days, which represents the highest level of addiction. Other groups are in between of the two extremes.
The y axis represent the percentage to fall into each group. For instance, if you are a female and you choose "famous people in movie or on TV use them", you will have 24% probability to fall into the group of "highest addiction".



